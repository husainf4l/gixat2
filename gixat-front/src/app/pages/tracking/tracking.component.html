@if (repairData()) {
  <!-- Tracking View -->
  <div class="min-h-screen bg-slate-50 font-sans">
    <main class="max-w-6xl mx-auto px-6 py-12 space-y-8">
      
      <!-- Top Info Bar -->
      <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
        <div class="bg-white rounded-xl border border-slate-200 p-6 shadow-sm transition-all hover:shadow-md">
          <div class="text-xs font-medium text-slate-500 mb-2">Vehicle Details</div>
          <div class="text-lg font-semibold text-slate-900 truncate">{{ repairData()!.vehicle }}</div>
          <div class="text-sm text-[#1b75bc] font-semibold mt-2">{{ repairData()!.plate }}</div>
        </div>
        <div class="bg-white rounded-xl border border-slate-200 p-6 shadow-sm transition-all hover:shadow-md">
          <div class="text-xs font-medium text-slate-500 mb-2">Current Status</div>
          <div class="text-lg font-semibold text-[#1b75bc] flex items-center gap-2">
            <i class="ri-time-line"></i> {{ repairData()!.status }}
          </div>
          <div class="text-sm text-slate-500 font-normal mt-2">Active Repair Session</div>
        </div>
        <div class="bg-white rounded-xl border border-slate-200 p-6 shadow-sm transition-all hover:shadow-md">
          <div class="text-xs font-medium text-slate-500 mb-2">Overall Progress</div>
          <div class="text-2xl font-semibold text-slate-900">{{ repairData()!.progress }}%</div>
          <div class="w-full h-2 bg-slate-100 rounded-full mt-3 overflow-hidden">
            <div class="h-full bg-[#1b75bc] transition-all duration-1000" [style.width.%]="repairData()!.progress"></div>
          </div>
        </div>
        <div class="bg-white rounded-xl border border-slate-200 p-6 shadow-sm transition-all hover:shadow-md">
          <div class="text-xs font-medium text-slate-500 mb-2">Estimated Pickup</div>
          <div class="text-lg font-semibold text-slate-900">{{ repairData()!.estimatedReady }}</div>
          <div class="text-sm text-emerald-600 font-medium mt-2">On Schedule</div>
        </div>
      </div>

      <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
        <!-- Left Column: Timeline -->
        <div class="lg:col-span-7 space-y-6">
          <div class="bg-white border border-slate-200 rounded-xl shadow-sm overflow-hidden">
            <div class="border-b border-slate-100 bg-slate-50 px-6 py-4">
              <h3 class="text-sm font-semibold text-slate-900 flex items-center gap-2">
                <i class="ri-history-line text-[#1b75bc]"></i> Repair Milestones
              </h3>
            </div>
            
            <div class="p-6 space-y-0 relative">
              <div class="absolute left-[43px] top-8 bottom-8 w-px bg-slate-200"></div>
              
              @for (stage of repairData()!.stages; track stage.id) {
                <div class="relative flex items-start gap-6 pb-10 last:pb-0">
                  <div [class]="'w-10 h-10 rounded-lg flex items-center justify-center relative z-10 transition-all border ' + 
                    (stage.status === 'completed' ? 'bg-emerald-50 border-emerald-200 text-emerald-600' : 
                    stage.status === 'active' ? 'bg-[#1b75bc] border-[#1b75bc] text-white shadow-sm' : 
                    'bg-white border-slate-200 text-slate-400')">
                    <i [class]="stage.icon + ' text-lg'"></i>
                  </div>
                  
                  <div class="flex-1 pt-1">
                    <div class="flex items-center justify-between mb-2">
                      <h4 [class]="'text-sm font-semibold ' + 
                        (stage.status === 'active' ? 'text-[#1b75bc]' : 
                        stage.status === 'completed' ? 'text-slate-900' : 'text-slate-400')">
                        {{ stage.label }}
                      </h4>
                      <span class="text-xs font-medium text-slate-500">{{ stage.time }}</span>
                    </div>
                    @if (stage.status === 'active') {
                      <div class="bg-slate-50 border border-slate-200 rounded-lg p-4">
                        <p class="text-sm text-slate-600 leading-relaxed">
                          <i class="ri-information-line text-[#1b75bc] mr-1"></i>
                          Our technician is currently performing the final stage of precision work on the drivetrain. All components are being torqued to factory specifications.
                        </p>
                      </div>
                    }
                    @if (stage.status === 'completed') {
                      <div class="flex items-center gap-1.5 text-xs text-emerald-600 font-medium">
                        <i class="ri-checkbox-circle-fill"></i> Verified
                      </div>
                    }
                  </div>
                </div>
              }
            </div>
          </div>
        </div>

        <!-- Right Column: AI Insights & Support -->
        <div class="lg:col-span-5 space-y-6">
          <!-- AI Diagnostic Report -->
          <div class="bg-[#1b75bc] rounded-xl p-6 text-white shadow-sm relative overflow-hidden">
            
            <div class="flex items-center gap-3 mb-6 relative z-10">
              <div class="w-10 h-10 bg-white/10 rounded-lg flex items-center justify-center backdrop-blur-sm border border-white/10">
                <i class="ri-ai-generate text-xl"></i>
              </div>
              <div>
                <h3 class="text-sm font-semibold">Diagnostic Intelligence</h3>
                <p class="text-xs text-blue-100">AI-Powered Analysis</p>
              </div>
            </div>
            
            <p class="text-base font-normal leading-relaxed text-white mb-8 relative z-10">
              "{{ repairData()!.aiInsight }}"
            </p>
            
            <div class="grid grid-cols-2 gap-4 pt-6 border-t border-white/10 relative z-10">
              <div class="flex items-center gap-3">
                <div class="w-10 h-10 rounded-full bg-white/20 flex items-center justify-center border border-white/10 overflow-hidden">
                  <img [src]="repairData()!.advisor.image" [alt]="repairData()!.advisor.name" class="w-full h-full object-cover" />
                </div>
                <div>
                  <p class="text-xs text-blue-100">Advisor</p>
                  <p class="text-sm font-semibold">{{ repairData()!.advisor.name }}</p>
                </div>
              </div>
              <div class="flex items-center justify-end gap-2">
                <div class="px-3 py-1.5 bg-white/10 rounded-lg text-xs font-medium border border-white/10">Verified</div>
              </div>
            </div>
          </div>

          <!-- Estimate Summary -->
          <div class="bg-white border border-slate-200 rounded-xl p-6 shadow-sm">
            <h3 class="text-sm font-semibold text-slate-900 mb-6 pb-3 border-b border-slate-100 flex justify-between items-center">
              <span>Billing Estimate</span>
              <i class="ri-file-list-3-line text-slate-400"></i>
            </h3>
            <div class="space-y-4">
              <div class="flex justify-between text-sm">
                <span class="text-slate-600">Labor Operations</span>
                <span class="text-slate-900 font-medium">${{ repairData()!.quote.labor.toFixed(2) }}</span>
              </div>
              <div class="flex justify-between text-sm">
                <span class="text-slate-600">OEM Parts</span>
                <span class="text-slate-900 font-medium">${{ repairData()!.quote.parts.toFixed(2) }}</span>
              </div>
              <div class="flex justify-between text-sm">
                <span class="text-slate-600">Service Taxes</span>
                <span class="text-slate-900 font-medium">${{ repairData()!.quote.tax.toFixed(2) }}</span>
              </div>
              <div class="pt-4 mt-2 border-t border-slate-200 flex justify-between items-end">
                <span class="text-xs font-medium text-slate-600">Total Amount</span>
                <span class="text-2xl font-semibold text-slate-900">${{ repairData()!.quote.total.toFixed(2) }}</span>
              </div>
            </div>
          </div>

          <!-- Support Actions -->
          <div class="grid grid-cols-2 gap-3">
            <button class="flex items-center justify-center gap-2 px-4 py-3 bg-slate-900 text-white rounded-lg font-medium text-sm hover:bg-slate-800 transition-all">
              <i class="ri-phone-line"></i> Call Shop
            </button>
            <button class="flex items-center justify-center gap-2 px-4 py-3 bg-white border border-slate-200 text-slate-700 rounded-lg font-medium text-sm hover:bg-slate-50 transition-all">
              <i class="ri-whatsapp-line text-emerald-500"></i> WhatsApp
            </button>
          </div>
        </div>
      </div>
    </main>

    <footer class="max-w-6xl mx-auto px-6 py-12 text-center space-y-4">
      <div class="flex items-center justify-center mb-3">
        <app-logo [height]="28" />
      </div>
      <p class="text-xs font-medium text-slate-500">Digital Service Record ID: {{ repairData()!.vin }}</p>
      <button (click)="resetTracking()" class="inline-flex items-center gap-2 px-4 py-2 bg-slate-100 text-slate-700 rounded-lg text-sm font-medium hover:bg-slate-200 transition-all">
        Track another vehicle <i class="ri-refresh-line"></i>
      </button>
    </footer>
  </div>
} @else {
  <!-- Lookup Form View -->
  <div class="min-h-screen bg-slate-50 font-sans flex flex-col">


    <!-- Hero / Lookup Section -->
    <main class="flex-1 flex flex-col lg:flex-row items-center justify-center max-w-7xl mx-auto w-full px-6 py-12 gap-16 lg:gap-24">
      
      <!-- Left: Branding & Value -->
      <div class="flex-1 text-center lg:text-left space-y-6">
        <div class="inline-flex items-center gap-2 px-3 py-1.5 bg-blue-50 text-[#1b75bc] rounded-full border border-blue-100 text-xs font-medium">
          <i class="ri-lock-2-line"></i> Secure Client Access
        </div>
        <h2 class="text-5xl lg:text-6xl font-semibold text-slate-900 tracking-tight leading-tight">
          Track your repair <br />
          <span class="text-[#1b75bc]">
            in real-time.
          </span>
        </h2>
        <p class="text-slate-600 text-lg leading-relaxed max-w-xl">
          Experience complete transparency. Watch every stage of your vehicle's service journey, from intake to testing, powered by Gixat's smart bay monitoring.
        </p>
        
        <div class="hidden lg:grid grid-cols-3 gap-6 pt-4">
          <div class="space-y-2">
            <p class="text-2xl font-semibold text-slate-900">Live</p>
            <p class="text-xs font-medium text-slate-500">Status Feed</p>
          </div>
          <div class="space-y-2">
            <p class="text-2xl font-semibold text-slate-900">AI</p>
            <p class="text-xs font-medium text-slate-500">Inspections</p>
          </div>
          <div class="space-y-2">
            <p class="text-2xl font-semibold text-slate-900">Full</p>
            <p class="text-xs font-medium text-slate-500">Transparency</p>
          </div>
        </div>
      </div>

      <!-- Right: Lookup Form -->
      <div class="w-full max-w-md">
        <div class="bg-white p-8 rounded-2xl border border-slate-200 shadow-sm">
          
          <h3 class="text-2xl font-semibold text-slate-900 tracking-tight mb-6">Service Lookup</h3>
          
          <form (ngSubmit)="handleTrack()" class="space-y-5">
            <div class="space-y-2">
              <label class="text-xs font-medium text-slate-600 ml-1">Plate Number</label>
              <div class="relative">
                <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none text-slate-400">
                  <i class="ri-car-line text-lg"></i>
                </div>
                <input 
                  type="text" 
                  [value]="plate()"
                  (input)="plate.set($any($event.target).value)"
                  placeholder="e.g. ABC-123"
                  class="w-full pl-12 pr-4 py-3 bg-white border border-slate-200 rounded-lg focus:ring-2 focus:ring-[#1b75bc] focus:border-transparent outline-none transition-all text-sm font-medium placeholder:text-slate-400"
                />
              </div>
            </div>

            <div class="space-y-2">
              <label class="text-xs font-medium text-slate-600 ml-1">Phone Number</label>
              <div class="relative">
                <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none text-slate-400">
                  <i class="ri-smartphone-line text-lg"></i>
                </div>
                <input 
                  type="tel" 
                  [value]="phone()"
                  (input)="phone.set($any($event.target).value)"
                  placeholder="Registered Mobile"
                  class="w-full pl-12 pr-4 py-3 bg-white border border-slate-200 rounded-lg focus:ring-2 focus:ring-[#1b75bc] focus:border-transparent outline-none transition-all text-sm font-medium placeholder:text-slate-400"
                />
              </div>
            </div>

            @if (error()) {
              <div class="p-4 bg-red-50 border border-red-100 rounded-lg flex items-start gap-3 text-red-600 text-sm">
                <i class="ri-error-warning-line text-lg mt-0.5"></i> 
                <p class="leading-relaxed">{{ error() }}</p>
              </div>
            }

            <div class="space-y-3 pt-2">
              <button 
                type="submit"
                [disabled]="isSearching()"
                class="w-full py-3 bg-[#1b75bc] text-white rounded-lg font-medium text-sm hover:bg-[#155a92] transition-all flex items-center justify-center gap-2 disabled:opacity-50 shadow-sm"
              >
                @if (isSearching()) {
                  <i class="ri-loader-4-line text-xl animate-spin"></i>
                } @else {
                  Track Progress <i class="ri-arrow-right-line"></i>
                }
              </button>

              <button 
                type="button"
                (click)="runDemo()"
                class="w-full flex items-center justify-center gap-2 text-sm font-medium text-[#1b75bc] hover:text-[#155a92] transition-colors py-2"
              >
                <i class="ri-play-circle-line text-lg"></i> Experience Live Demo
              </button>
            </div>
          </form>
        </div>
        
        <p class="text-center mt-8 text-xs text-slate-500">
          <i class="ri-shield-check-line"></i> Encrypted & Secure Vehicle Data
        </p>
      </div>
    </main>
  </div>
}

